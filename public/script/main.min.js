function connectToNewUser(e,o){const t=myPeer.call(e,o),n=document.createElement("video");n.setAttribute("class",`peerVideo ${e}`),peersName.push(e),console.table(peersName),t.on("stream",e=>{addVideoStream(n,e)}),t.on("close",()=>{n.remove()}),peers[e]=t}function addVideoStream(e,o){e.srcObject=o,e.addEventListener("loadedmetadata",()=>{e.play()}),"selfVideo"==e.id&&videoGridSelf.append(e),""==e.id&&videoGrid.append(e)}const socket=io("/"),videoGrid=document.querySelector("#container--video"),videoGridSelf=document.querySelector("#container--selfVideo"),name=document.getElementById("name"),nameSelf=document.getElementById("nameSelf"),myPeer=new Peer(void 0,{host:"/",port:"3001"}),selfVideo=document.createElement("video");selfVideo.setAttribute("id","selfVideo"),selfVideo.muted=!0;var peersName=[];let ownName={},peers={};navigator.mediaDevices.getUserMedia({video:!0,audio:!0}).then(e=>{addVideoStream(selfVideo,e),myPeer.on("call",o=>{o.answer(e);const t=document.createElement("video");t.setAttribute("class","peerVideo"),o.on("stream",e=>{addVideoStream(t,e)})}),socket.on("user-connected",o=>{setTimeout(()=>{connectToNewUser(o,e),console.log("User connected :",o)},1500),alert(o+" joined")}),console.log("all good ?")}).catch(()=>{console.log("video and audio did not work")}),socket.on("user-disconnected",e=>{setTimeout(()=>{console.log("User disconnected :",e);for(let o=0;o<peersName.length;o++)e==peersName[o]&&peersName.splice(o,1);0!=peersName.length&&console.table(peersName),peers[e]&&peers[e].close();for(let o in peers)peers[e]==o&&peers[e].close()},1500)}),myPeer.on("open",e=>{socket.emit("join-room",ROOM_ID,e)});let peersContainer=document.getElementById("container--video"),peersChildren={childList:peersContainer.childNodes};const other=document.getElementsByTagName("video"),observer=new MutationObserver(function(){0===peersChildren.childList.length&&alert("You're alone, maybe you want to leave ?")});observer.observe(peersContainer,peersChildren),document.getElementById("roomId").innerHTML+=`<b>Room ID</b> <span id="roomidSpan">${ROOM_ID}</span>`,document.getElementsByTagName("title")[0].innerHTML+="-- "+ROOM_ID;